containers:
  dev:
    image: node:17-alpine3.12
    volumes:
      - local: .
        container: /code
        options: cached
      - type: cache
        name: node_modules
        container: /code/node_modules
    working_directory: /code
    enable_init_process: true
    run_as_current_user:
      enabled: true
      home_directory: /home/container-user

tasks:
  get-node-deps:
    description: Install node dependencies
    run:
      container: dev
      command: npm install

  start:
    prerequisites:
      - get-node-deps
    run:
      container: dev
      ports:
        - 3000:3000
      command: npm run start

  start:server:
    prerequisites:
      - get-node-deps
    run:
      container: dev
      ports:
        - 8080:8080
      command: node server.js

  start:bash:
    run:
      container: dev
      command: sh
